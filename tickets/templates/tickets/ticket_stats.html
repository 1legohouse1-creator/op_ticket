{% extends 'tickets/base.html' %}
{% block content %}
<div class="container mt-4">
    <h3>통계 / 리포트</h3>
    <div class="card mb-4"><div class="card-body"><h5 class="card-title">기간별 조회</h5><form method="get" class="row g-3 align-items-center mb-3"><div class="col-auto"><input type="date" class="form-control" name="start_date" value="{{ start_date|default:'' }}"></div><div class="col-auto">~</div><div class="col-auto"><input type="date" class="form-control" name="end_date" value="{{ end_date|default:'' }}"></div><div class="col-auto"><button type="submit" class="btn btn-primary">조회</button></div></form><h5 class="card-title mt-4">간편 조회</h5><div><a href="{% url 'ticket_stats' %}" class="btn btn-sm {% if not current_year and not start_date %}btn-dark{% else %}btn-outline-dark{% endif %} mb-1">전체</a>{% for year in available_years %}<a href="?year={{ year }}" class="btn btn-sm {% if current_year == year and not current_month %}btn-dark{% else %}btn-outline-dark{% endif %} mb-1">{{ year }}년</a>{% endfor %}<br>{% for month in available_months %}<a href="?year={{ current_year|default:'' }}&month={{ month }}" class="btn btn-sm {% if current_month == month %}btn-dark{% else %}btn-outline-dark{% endif %} mb-1">{{ month }}월</a>{% endfor %}</div></div></div>
    <div class="row"><div class="col-lg-12 mb-4"><div class="card"><div class="card-header">전체 수술 건수 ({{ filter_display_text }})</div><div class="card-body"><h2 class="card-title">{{ total_count }} 건</h2></div></div></div></div>
    <div class="row mb-4"><div class="col-lg-4"><div class="card h-100"><div class="card-header">수술 파트별</div><ul class="list-group list-group-flush">{% for stat in part_stats %}<li class="list-group-item d-flex justify-content-between align-items-center">{% if stat.part_type == 'upper' %}Upper{% elif stat.part_type == 'tl' %}T&L{% elif stat.part_type == 'foot' %}Foot{% else %}{{ stat.part_type|default:"(미지정)" }}{% endif %}<span class="badge bg-primary rounded-pill">{{ stat.count }}</span></li>{% empty %}<li class="list-group-item">데이터가 없습니다.</li>{% endfor %}</ul></div></div><div class="col-lg-4"><div class="card h-100"><div class="card-header">집도의별</div><ul class="list-group list-group-flush">{% for stat in professor_stats %}<li class="list-group-item d-flex justify-content-between align-items-center">{{ stat.professor_name|default:"(미지정)" }}<span class="badge bg-primary rounded-pill">{{ stat.count }}</span></li>{% empty %}<li class="list-group-item">데이터가 없습니다.</li>{% endfor %}</ul></div></div><div class="col-lg-4"><div class="card h-100"><div class="card-header">마취 방법별</div><ul class="list-group list-group-flush">{% for stat in anesthesia_stats %}<li class="list-group-item d-flex justify-content-between align-items-center">{{ stat.anesthesia|default:"(미지정)" }}<span class="badge bg-primary rounded-pill">{{ stat.count }}</span></li>{% empty %}<li class="list-group-item">데이터가 없습니다.</li>{% endfor %}</ul></div></div></div>
</div>
{% endblock %}